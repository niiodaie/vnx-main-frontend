<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Visnec Nexus - Digital Innovation Hub</title>
<meta content="Visnec Nexus - VNX - A global digital innovation hub featuring AI tools, platforms, and resources for creators and innovators worldwide." name="description"/>

<script>
  const countryLangMap = {
    'KE': 'sw', 'TZ': 'sw', 'UG': 'sw',
    'US': 'en', 'FR': 'fr', 'ES': 'es'
  };

  function updateContent() {
    document.querySelectorAll('[data-i18n]').forEach(elem => {
      const key = elem.getAttribute('data-i18n');
      elem.innerHTML = i18next.t(key);
    });
  }

  function changeLang(lng) {
    i18next.changeLanguage(lng, updateContent);
    localStorage.setItem('preferredLang', lng);
  }

  function setLanguageByCountry(countryCode) {
    const lang = countryLangMap[countryCode] || 'en';
    i18next.changeLanguage(lang, updateContent);
    localStorage.setItem('preferredLang', lang);
  }

  function detectUserLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        position => {
          fallbackIPGeolocation();
        },
        error => {
          console.warn('Browser geolocation error:', error.message);
          fallbackIPGeolocation();
        },
        { timeout: 5000 }
      );
    } else {
      console.warn('Browser geolocation not supported');
      fallbackIPGeolocation();
    }
  }

  function fallbackIPGeolocation() {
    fetch('https://ipapi.co/json/')
      .then(res => res.json())
      .then(data => {
        console.log('IP Geolocation detected country:', data.country_code);
        setLanguageByCountry(data.country_code);
      })
      .catch(err => {
        console.warn('IP geolocation failed:', err);
        setLanguageByCountry('en');
      });
  }

  i18next
    .use(i18nextHttpBackend)
    .use(i18nextBrowserLanguageDetector)
    .init({
      fallbackLng: 'en',
      debug: false,
      backend: {
        loadPath: '/locales/{{lng}}/translation.json'
      }
    }, function(err, t) {
      if (err) return console.error('i18next init failed:', err);
      updateContent();
      showCookieConsent();
      detectUserLocation();

      const savedLang = localStorage.getItem('preferredLang');
      if (savedLang) {
        i18next.changeLanguage(savedLang, updateContent);
      }
    });
</script>
